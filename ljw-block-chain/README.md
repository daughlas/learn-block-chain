# 区块链概念
## 区块链是什么
1. 阿道夫
2. 区块链是一个较为完整的知识体系
  * 本质就是分布式数据库
  * 比特币造就了区块链，但是不是等于的关系
  * 村庄小例子，理解记账 挖矿 共识等机制

### 村庄的故事 1.0
中心记账 专门的账房先生
  * 中心式，效率高
  * 账房先生生病，则系统崩溃
  * 账房先生使坏，偷偷修改账本，个人没办法

### 村庄的故事 2.0
点对点记账方式
  * 所有人都可以记账
  * 没有人说了算，所以要投票，衍生出了挖矿、分布式
  * 每个人都有一个账本
  * 账本每一页记录着交易信息，账本的哈希值，时间，上一页的哈希，和自己的签名
  * 村民转账，用自己家的大喇叭向全村广播（p2p 广播），同时签上自己的签名
  * 有人生病，痊愈之后，问别人同步一下账本即可
  * 记账比较麻烦，鼓励记账，转账要收手续费，记账会有矿工奖励
  * 因为有奖励，大家都想记账，用算数学题的方式，争抢记账权（比特币：工作量证明机制）
  * 特点：不可篡改，去中心化不会宕机，系统运行比较慢
  * 总结：分布式、不可篡改、缓慢的数据库

### 区块链的发展
1. 区块链 1.0 比特币（各种币），一个区块里面只有一个货币
2. 区块链 2.0 以太坊（智能合约），区块里边不仅有交易数据，在链上用 solidaty 写自己的代码，条件成立的时候执行里边的代码，不仅可以做交易
3. 区块链 3.0，联盟链，身份认证，教育行业的链

### 相关资源
* https://github.com/shengxinjing/iblockchain
* https://bitcoin.org/bitcoin.pdf
* https://ww.imooc.com/learn/988

## 数字货币
区块链现在最广泛的应用
* 比特币、EOS、USDT、LTC、DOGE，Ripple 等等
* 以太坊
* USDT 与美元挂钩，1:1 兑换

更好的流动 产生价值
* ICO：众筹
* 交易所：场所、撮合，分为场内交易和场外交易
* 钱包：存储

所谓货币 哪里之前（比特币为什么值钱）
* 供需决定价格
* 总量是稳定的
* 支付方便 透明中立

## 区块链应用场景
特性：
* 不可篡改的属性
* 去中心化 + 透明
* 价值传递（互联网出现解决了快捷的信息传递）

前景展望：
* 数字货币 + 支付
* 共享经济 + 信用传递（ofo 还是中心化的租借模式）
* 食品安全（信息造假，生产日期假的，来自信息来 XX 牧场）
* 数字版权
* 众筹（钱去哪儿了，用在哪儿是可以看到的，避免现在的黑盒）
* 金融审计
* 合约
* 游戏
* 可编程社会（比信息化再高级一点）
* 智能合约：符合条件，自动执行
* 学术、选举
* 游戏、音乐、视频

不能应用的项目（因为他是一个缓慢的数据库）：
高频操作、聊天，实时互动的游戏不可能

有前途的项目：
* IPFS（星际文件系统）课程会用到
* 超级账本 fabric，区块链 3.0 代表项目
* NameCoin 链上数据库

具体应用领域：
* 公有链
* 私有链
* 联盟链， toB 的链，教育链

### 定义
区块链：分布式、不可篡改、信息透明化的、昂贵的、缓慢的数据库



# 区块链技术概念
## 哈希
HASH 值的特点：
1. 同一个值通过同一个哈希算法算出来的值永远是同一个
2. 长度固定，给定任意长度的数据，算出固定长度的值
3. 逆向困难，根据哈希很难算出原来的值
4. 输入敏感，输入修改一点点，哈希会发生天翻地覆的变化
5. 输入碰撞，非常难找到两个不同的值会得到同一个 HASH 值
6. HASH 特点：正向快速，逆向困难，输入敏感，碰撞避免
## 共识 POW，POS 和 DPOS
共识机制
* POW（proof of work） 工作量证明，费劲，消耗能源
* POS 权益证明，谁占的股份多，谁说了算
* DPOS 代理权益证明（类似人民代表大会制度），定期所有节点竞选代表，可能会贿选
## 非对称加密
* 非对称加密 约等于 签名 + 校验
* 蜗牛 ===》 你今天吃啥了？  ===》 小明
* 被篡改 蜗牛 ===》 你是傻子吗？  ===》 小明 
* 最早的加密，就是根据字母表替换
* 加密分类
  1. 对称加密：只有一个密钥，要共享
  2. 非对称加密： 公钥 + si
### 对称加密
只有一个密钥
密钥需要在两端共享
优点：计算效率高，加密强度也比较高
缺点：前期需要共享密钥
经典应用： AES、DES
蜗牛 ===》 你今天吃啥了？  ===》 小明
变成 
蜗牛 密钥加密(你今天吃了吗) ===》 密文 ===》 密钥解密(密文) 你今天吃了吗  小明
### 非对称加密
有一对公私钥
公钥可以根据私钥计算得来
不可逆行
私钥可以算出公钥，公钥不能算出私钥
私钥一般是随机字符串
应用： RSA非对称加密
蜗牛发送 信息 + 私钥加密(签名) + 公钥
小明收到 信息 + 加密后的签名 + 公钥 通过公钥验证签名是否合法，此时信息是不是明文不重要了，因为我能证明是蜗牛发送的信息
例子
```
getpub woniu
sign imoocisgood woniu
verify imoocisgood 公钥 签名
```
## 拜占庭将军问题-容错
一些节点挂了，一些节点发出了错误的信息
## p2p 网络
点对点
启动软件，就变成一个节点

个人电脑没有公网 ip 别人如何和你通讯呢

以太坊完全去中心化 DHT（分布式哈希表） 的 Kademlia 网络

启动节点存储整个网络的节点信息，新节点加入了，就告诉他节点在哪儿

下图展示了一个 P2P 网络

![image-20190216164048253](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190216164048253.png)

## 区块

分布式，系统部署在多个节点之上

地址：

区块：

DAPP：去中心化的应用

智能合约：部署到一个地址上的代码，符合一定条件（去中心化，不受人为干预）的条件下执行这段代码

钱包：存储数字货币，私钥

CAP 原理和 Paxos ，raft 算法

拜占庭容错





# 第三章 nodeJs 区块链实战

`mkdir woniu-chain`

`cd woniu-chain`

`npm init`

`mkdir src`

`cd src`

`touch blockchain.js`

## 需求

1. 迷你区块链

2. 区块链的生成，新增，校验

3. 交易

4. 非对称较密

5. 挖矿

6. p2p 网络

   ```
   // 一个区块的数据结构
   {
       index: 索引,
       timestamp: 时间戳,
       data: 区块的具体信息，主要是交易信息,
       hash：当前区块信息的哈希,
       prevHash: 上一个区块的哈希,
       nonce: 随机数
   }
   ```

   

4-1

```
const cryto = require('crypto)

class Blockchain {
    constructor() {
        this.blockchain = []
        this.data = []
        this.difficulty = 4
        const hash = this.computeHash(0, '0', new Date().getTime(), 'Hello woniu-chain', 1)
        console.log(hash)
    }
    
    mine() {
        // 1. 生成新区块
        // 2. 不停的计算 hash 直到符合难度的条件 新增区块
    }
    
    generateNewBlock() {}
    
    computeHash(index, prevHash, timestamp, data, nonce) {
        return crypto
        		.createHash('sha256')
        		.update(index, prevHash, timestamp, data, nonc)
        		.digest('hex')
    }
    
    isValidBlock() {}
    
    isValidChain() {}
}

let bc = new Blockchain()
```



# 第四章 智能合约

区块链上面写的代码

counter.js

```
class Counter {
    constructor() {
        this.num = 0
    }
    increment() {
        this.num++
    }
    getNum() {
        return this.num
    }
}
```

counter.sol

```
// 版本声明
pragma solidity ^0.4.24;

contract Counter {
    unit num;
    constructor() {
        num = 0;
    }
    // 函数类型 public 公用函数
    function increment() public {
        num +=1;
    }
     // view 函数 只读取变量 不写入
     // 声名返回类型
    function getNum() view returns (unit) {
        return num;
    }
}
```

remix 在线编辑器











